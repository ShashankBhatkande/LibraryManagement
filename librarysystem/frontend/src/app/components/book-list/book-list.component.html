<mat-sidenav-container class="sidenav-container">
  <!-- Sidebar -->
  <mat-sidenav mode="side" opened class="sidenav">
    <h2 class="logo">
      <span class="welcome-text">Welcome,</span><br>
      <span class="username">{{ username }}</span>
    </h2>

    <mat-divider></mat-divider>

    <button *ngIf="roleService.hasAtLeast('ROLE_LIBRARIAN')" mat-button [routerLink]="['/add-book']">
      âž• Add Book
    </button>

    <button *ngIf="roleService.hasAtLeast('ROLE_ADMIN')" mat-button [routerLink]="['/show-user']">
      ðŸ‘¥ Show Users
    </button>

    <button mat-button [routerLink]="['/view-myprofile']">
      ðŸ‘¤ My Profile
    </button>

    <button *ngIf="roleService.hasAtLeast('ROLE_LIBRARIAN')" mat-button [routerLink]="['/view-profile']">
      ðŸ“‘ Profiles
    </button>
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content class="main-content">
    <div class="topbar">
      <div class="filters">
        <mat-form-field appearance="outline">
          <mat-label>Search by title</mat-label>
          <input matInput [formControl]="searchControl" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Genres</mat-label>
          <mat-select [formControl]="genreControl" multiple>
            <mat-option *ngFor="let g of genres" [value]="g">{{ g }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Authors</mat-label>
          <mat-select [formControl]="authorControl" multiple>
            <mat-option *ngFor="let a of authors" [value]="a">{{ a }}</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="view-toggle">
          <button mat-stroked-button (click)="setViewMode('grid')">Grid</button>
          <button mat-stroked-button (click)="setViewMode('list')">List</button>
        </div>
      </div>
    </div>

    <!-- Grid View -->
    <div *ngIf="viewMode === 'grid'" class="grid-view">
      <mat-card *ngFor="let book of books" class="book-card">
        <img *ngIf="book.imageUrl" [src]="book.imageUrl" alt="{{ book.title }}" class="book-image" />
        <mat-card-content>
          <h3>{{ book.title }}</h3>
          <p><strong>Genre:</strong> {{ book.genre }}</p>
          <p><strong>Author:</strong> {{ book.author }}</p>
          <p><strong>Quantity:</strong> {{ book.quantity }}</p>
        </mat-card-content>
        <mat-card-actions>
          <button *ngIf="roleService.hasAtLeast('ROLE_LIBRARIAN')" mat-raised-button color="primary"
            [routerLink]="['/update-book', book.id]">
            Update
          </button>
          <button *ngIf="roleService.hasAtLeast('ROLE_LIBRARIAN')" mat-raised-button color="warn"
            (click)="onDelete(book)">
            Delete
          </button>
          <button mat-raised-button color="accent" (click)="onBorrow(book)">
            Borrow
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- List View -->
    <div *ngIf="viewMode === 'list'" class="list-view">
      <div *ngFor="let book of books" class="book-row">
        <img *ngIf="book.imageUrl" [src]="book.imageUrl" alt="{{ book.title }}" class="book-thumb" />
        <div class="book-info">
          <strong>{{ book.title }}</strong> - {{ book.genre }} - {{ book.author }}
          ({{ book.quantity }} available)
        </div>
        <div class="actions">
          <button *ngIf="roleService.hasAtLeast('ROLE_LIBRARIAN')" mat-button color="primary"
            [routerLink]="['/update-book', book.id]">
            Update
          </button>
          <button *ngIf="roleService.hasAtLeast('ROLE_LIBRARIAN')" mat-button color="warn" (click)="onDelete(book)">
            Delete
          </button>
          <button mat-button color="accent" (click)="onBorrow(book)">
            Borrow
          </button>
        </div>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>